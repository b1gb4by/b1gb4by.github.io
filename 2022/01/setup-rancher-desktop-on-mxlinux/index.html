<!doctype html><html lang=ja>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BRRNK5J7PW"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-BRRNK5J7PW')</script>
<meta name=google-site-verification content="MI9tWDvB5U3u_StKcJVdMhElMqisSGg7sJaKL0XmdMg">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>MXLinux で Rancher Desktop を動かす | </title><meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/featured-image.webp">
<meta name=twitter:title content="MXLinux で Rancher Desktop を動かす">
<meta name=twitter:description content="Rancher Desktop v1.0.0 がリリースされたので、実際に MXLinux で動かしてみました"><meta name=twitter:creator content="@m0rer0"><meta name=Description content="Rancher Desktop v1.0.0 がリリースされたので、実際に MXLinux で動かしてみました"><meta property="og:title" content="MXLinux で Rancher Desktop を動かす">
<meta property="og:description" content="Rancher Desktop v1.0.0 がリリースされたので、実際に MXLinux で動かしてみました">
<meta property="og:type" content="article">
<meta property="og:url" content="https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/"><meta property="og:image" content="https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/featured-image.webp"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-01-27T23:26:46+09:00">
<meta property="article:modified_time" content="2022-01-28T05:15:52+09:00">
<meta name=application-name content="morero's blog">
<meta name=apple-mobile-web-app-title content="morero's blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=favicon.svg type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/lib/prismjs/prism.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"MXLinux で Rancher Desktop を動かす","inLanguage":"ja","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/t4i5uKE.github.io\/2022\/01\/setup-rancher-desktop-on-mxlinux\/"},"image":[{"@type":"ImageObject","url":"https:\/\/t4i5uKE.github.io\/2022\/01\/setup-rancher-desktop-on-mxlinux\/featured-image.webp","width":800,"height":300}],"genre":"posts","keywords":"kubernetes, k3s, rancher, helm, containerd, moby, linux, mxlinux","wordCount":4317,"url":"https:\/\/t4i5uKE.github.io\/2022\/01\/setup-rancher-desktop-on-mxlinux\/","datePublished":"2022-01-27T23:26:46+09:00","dateModified":"2022-01-28T05:15:52+09:00","description":"Rancher Desktop v1.0.0 がリリースされたので、実際に MXLinux で動かしてみました"}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ホーム","item":"https:\/\/t4i5uKE.github.io\/"},{"@type":"ListItem","position":2,"name":"Kubernetes","item":"https://t4i5uKE.github.io/categories/kubernetes/"},{"@type":"ListItem","position":3,"name":"MXLinux で Rancher Desktop を動かす"}]}</script></head>
<body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header>
<div class="desktop header" id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="morero's blog" class="header-logo logo-svg">morero's blog</a>
</div>
<div class=menu>
<nav>
<h2 class=display-hidden>Основная навигация</h2>
<ul class=menu-inner><li>
<a class=menu-item href=/posts/> 記事 </a>
</li><li>
<a class=menu-item href=/tags/> タグ </a>
</li><li>
<a class=menu-item href=/categories/> カテゴリ </a>
</li><li>
<a class=menu-item href=/resume/> 経歴 </a>
</li><li>
<a class=menu-item href=/about/> WHORU? </a>
</li></ul>
</nav><span class="menu-item delimiter"></span><span onclick="void 0" class="menu-item language" title=言語を選択>Japanese<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/en/2022/01/setup-rancher-desktop-on-mxlinux/>English</option><option value=/2022/01/setup-rancher-desktop-on-mxlinux/ selected>Japanese</option></select>
</span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="タイトルやコンテンツの検索 ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=検索>
<span class="svg-icon icon-search"></span>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=クリア>
<span class="svg-icon icon-cancel"></span>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<span class="svg-icon icon-loading"></span>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=テーマを変更する>
<span class="svg-icon icon-moon"></span>
</a>
</div>
</div>
</div><div class="mobile header" id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="morero's blog" class=header-logo>morero's blog</a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="タイトルやコンテンツの検索 ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=検索>
<span class="svg-icon icon-search"></span>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=クリア>
<span class="svg-icon icon-cancel"></span>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<span class="svg-icon icon-loading"></span>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
キャンセル
</a>
</div><nav>
<h2 class=display-hidden>Основная навигация</h2>
<ul><li>
<a class=menu-item href=/posts/ title>記事</a>
</li><li>
<a class=menu-item href=/tags/ title>タグ</a>
</li><li>
<a class=menu-item href=/categories/ title>カテゴリ</a>
</li><li>
<a class=menu-item href=/resume/ title>経歴</a>
</li><li>
<a class=menu-item href=/about/ title>WHORU?</a>
</li></ul>
</nav>
<a href=javascript:void(0); class="menu-item theme-switch" title=テーマを変更する>
<span class="svg-icon icon-moon"></span>
</a><span onclick="void 0" class=menu-item title=言語を選択>Japanese<select class=language-select onchange="location=this.value"><option value=/en/2022/01/setup-rancher-desktop-on-mxlinux/>English</option><option value=/2022/01/setup-rancher-desktop-on-mxlinux/ selected>Japanese</option></select>
</span></div>
</div>
</div><div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div></header><main class=main>
<div class="container content-article page-toc theme-classic"><div class=toc id=toc-auto>
<div class=toc-title>コンテンツ</div>
<div class=toc-content id=toc-content-auto></div>
</div>
<article>
<header class=header-post>
<div class=post-title>
<div class=post-all-meta>
<nav class=breadcrumbs>
<ol>
<li><a href=/>ホーム </a></li><li><a href=/categories/kubernetes/>Kubernetes </a></li><li>MXLinux で Rancher Desktop を動かす</li>
</ol>
</nav>
<h1 class="single-title flipInX">MXLinux で Rancher Desktop を動かす</h1><div class="post-meta summary-post-meta"><span class="post-category meta-item">
<a href=/categories/kubernetes/><span class="svg-icon icon-folder"></span>Kubernetes</a>
</span><span class="post-meta-date meta-item">
<span class="svg-icon icon-clock"></span><time class=timeago datetime=2022-01-27>2022-01-27</time>
</span><span class="post-meta-words meta-item">
<span class="svg-icon icon-pencil"></span>4317 文字
</span>
<span class="post-meta-reading meta-item">
<span class="svg-icon icon-stopwatch"></span>9 分
</span>
</div>
</div>
</div>
</header>
<div class="article-post toc-start">
<div class="content-block content-block-first content-block-position">
<div class="post single"><div class=image-theme-classic>
<img src=https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/featured-image.webp style=width:100%>
</div><div class="details toc" id=toc-static data-kept>
<div class="details-summary toc-title">
<span>コンテンツ</span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#rancher-desktop-とは>Rancher Desktop とは</a></li>
<li><a href=#必要条件>必要条件</a>
<ul>
<li><a href=#macos>macOS</a></li>
<li><a href=#windowsos>WindowsOS</a></li>
<li><a href=#linux>Linux</a></li>
<li><a href=#マシンスペック>マシンスペック</a></li>
</ul>
</li>
<li><a href=#動作の仕組み>動作の仕組み</a></li>
<li><a href=#mxlinux-へのインストール>MXLinux へのインストール</a></li>
<li><a href=#rancher-desktop-の起動>Rancher Desktop の起動</a>
<ul>
<li><a href=#general>General</a></li>
<li><a href=#kubernetes-setting>Kubernetes Setting</a></li>
<li><a href=#supporting-utilities>Supporting Utilities</a></li>
<li><a href=#images>Images</a></li>
<li><a href=#troubleshooting>Troubleshooting</a></li>
</ul>
</li>
<li><a href=#検証>検証</a>
<ul>
<li><a href=#nerdctl-の使用>nerdctl の使用</a></li>
<li><a href=#helm-の使用>Helm の使用</a>
<ul>
<li><a href=#helm-に-grafana-のリポジトリを追加>Helm に Grafana のリポジトリを追加</a></li>
<li><a href=#helm-にリポジトリが追加されていることを確認>Helm にリポジトリが追加されていることを確認</a></li>
<li><a href=#追加した-grafana-リポジトリからチャートを確認>追加した Grafana リポジトリからチャートを確認</a></li>
<li><a href=#helm-チャートをリリース>Helm チャートをリリース</a></li>
</ul>
</li>
</ul>
</li>
<li><a href=#所感>所感</a></li>
</ul>
</nav></div>
</div><div style="margin:20px 0">
<span class=post-update>
<span class=s>更新日時 2022-01-28</span>
</span>
</div><p>1月26日に、<a href=https://rancherdesktop.io/ target=_blank rel="noopener noreffer">Rancher Desktop</a> が正式に <a href=https://github.com/rancher-sandbox/rancher-desktop/releases/tag/v1.0.0 target=_blank rel="noopener noreffer">v1.0.0</a> としてリリースされました.</p>
<p>今回は、実際に Rancher Desktop を MXLinux にインストールして動かそうと思います.</p>
<h2 id=rancher-desktop-とは class=headerLink><a href=#rancher-desktop-%e3%81%a8%e3%81%af class=header-mark></a>Rancher Desktop とは</h2><p>Rancher Desktop は Electron と Node.js をベースに構築されたデスクトップアプリケーションであり、デスクトップ上で Kubernetes とコンテナ管理を実行することができます.</p>
<p>また、実行する Kubernetes のバージョンを自由に選択することができます.</p>
<p><code>containerd</code>、または<code>Moby (dockerd)</code>を使って、コンテナイメージのビルド、プッシュ、プル、実行が可能です. ビルドしたコンテナイメージは、レジストリを必要とせず、すぐに Kubernetes で実行できます.</p>
<h2 id=必要条件 class=headerLink><a href=#%e5%bf%85%e8%a6%81%e6%9d%a1%e4%bb%b6 class=header-mark></a>必要条件</h2><p>OSS のデスクトップアプリケーションで、macOS や Windows、そして Linux の様々な環境で動作させることができます. M1 にも対応しているため、ほとんどの環境で動作が可能になりました.</p>
<p>環境での必要条件は以下の通りです.</p>
<h3 id=macos class=headerLink><a href=#macos class=header-mark></a>macOS</h3><ul>
<li><strong>macOS</strong>
<ul>
<li>Catalina 10.15 以降</li>
</ul>
</li>
<li><strong>CPUアーキテクチャ</strong>
<ul>
<li>Apple Silicon（M1）または VT-x 搭載の Intel CPU</li>
</ul>
</li>
</ul>
<h3 id=windowsos class=headerLink><a href=#windowsos class=header-mark></a>WindowsOS</h3><ul>
<li><strong>Windows</strong>
<ul>
<li>Windows 10 ビルド 1909 以降</li>
<li>Home エディションにも対応</li>
</ul>
</li>
<li><strong>Hyper-V(仮想化機能)</strong> が有効化されている</li>
<li><strong>Windows Subsystem for Linux (WSL)</strong>
<ul>
<li>Rancher Desktop は、Windows 上で WSL が必要ですが、セットアップの一部として自動的にインストールされます</li>
<li>手動でディストリビューションをダウンロードは不要</li>
</ul>
</li>
</ul>
<h3 id=linux class=headerLink><a href=#linux class=header-mark></a>Linux</h3><ul>
<li><code>.deb</code>や<code>.rpm</code>パッケージ、または<code>AppImages</code>をインストールできるディストリビューション</li>
</ul>
<h3 id=マシンスペック class=headerLink><a href=#%e3%83%9e%e3%82%b7%e3%83%b3%e3%82%b9%e3%83%9a%e3%83%83%e3%82%af class=header-mark></a>マシンスペック</h3><ul>
<li>8GB のメモリー</li>
<li>4コアのCPU</li>
</ul>
<h2 id=動作の仕組み class=headerLink><a href=#%e5%8b%95%e4%bd%9c%e3%81%ae%e4%bb%95%e7%b5%84%e3%81%bf class=header-mark></a>動作の仕組み</h2><p>Rancher Desktopは、他のツールをラッピングしながら、動作を実現しています.</p>
<p>MacOSとLinuxでは、<a href=https://github.com/lima-vm/lima target=_blank rel="noopener noreffer">Lima</a> や <a href=https://www.qemu.org/ target=_blank rel="noopener noreffer">QEMU</a> といった仮想マシンを活用して<code>containerd</code>または<code>dockerd</code>と Kubernetes (<a href=https://k3s.io/ target=_blank rel="noopener noreffer">k3s</a>) を実行します.</p>
<p>Windowsシステムでは、<a href=https://docs.microsoft.com/en-us/windows/wsl/ target=_blank rel="noopener noreffer">Windows Subsystem for Linux v2 (WSL2)</a> を利用しています.</p>
<blockquote>
<p>下図は <a href=https://rancherdesktop.io/ target=_blank rel="noopener noreffer">rancher</a> から引用
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/how-it-works-rancher-desktop.webp alt=how-it-works-rancher-desktop title=how-it-works-rancher-desktop.webp></p>
</blockquote>
<p>Rancher Desktopでは、<a href=https://github.com/containerd/nerdctl target=_blank rel="noopener noreffer">NERDCTL プロジェクト</a>と Docker CLI を利用して、イメージを build、push、pull する機能が用意されています.
なお、<code>nerdctl</code> と <code>docker</code> の両方が自動的にパスに入れられます. Windowsではインストーラー中に、macOSとLinuxでは初回実行時に行われます.</p>
<p>いずれのツールを使用する場合も、Rancher Desktop が適切なコンテナランタイムで実行されている必要があります.</p>
<p><code>nerdctl</code>の場合は、<code>containerd</code>ランタイムを使用します。dockerの場合は、<code>dockerd (moby)</code>ランタイムを使用します.</p>
<div class="details admonition note">
<div class="details-summary admonition-title"><i class="icon admonition-icon icon-note"></i>Lima について<i class="details-icon admonition-icon admonition-icon-arrow-right"></i></div>
<div class=details-content>
<div class=admonition-content>Lima は WSL と似ており、自動ファイル共有とポート転送、および containerd を備えた Linux の仮想マシンを起動します. LimaはmacOSホストで使われることが想定されていますが、Linuxホストでも使うことができます.</div>
</div>
</div>
<div class="details admonition note">
<div class="details-summary admonition-title"><i class="icon admonition-icon icon-note"></i>QEMU について<i class="details-icon admonition-icon admonition-icon-arrow-right"></i></div>
<div class=details-content>
<div class=admonition-content>QEMUは、OSS の PC エミュレーターです. x86 や SPARC、MIPS といったさまざまな CPU 上の Linux、Windows などで動作し、ほかのCPUの命令をネイティブコードに変換しながら実行できるという特徴を持ちます.</div>
</div>
</div>
<div class="details admonition note">
<div class="details-summary admonition-title"><i class="icon admonition-icon icon-note"></i>k3s について<i class="details-icon admonition-icon admonition-icon-arrow-right"></i></div>
<div class=details-content>
<div class=admonition-content>k3sは、Rancher Labs社が発表した軽量な Kubernetes の1つで、40MB未満のバイナリと、わずか512MBのメモリ使用量を特徴としています. 最近では、IoT や Edge コンピューティングなどでの活用が期待されています.</div>
</div>
</div>
<div class="details admonition note">
<div class="details-summary admonition-title"><i class="icon admonition-icon icon-note"></i>nerdctl について<i class="details-icon admonition-icon admonition-icon-arrow-right"></i></div>
<div class=details-content>
<div class=admonition-content>nerdctl は containerd 向けのコンテナの操作ツールです. containerd用の docker コマンドだと考えていただければと思います.</div>
</div>
</div>
<h2 id=mxlinux-へのインストール class=headerLink><a href=#mxlinux-%e3%81%b8%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab class=header-mark></a>MXLinux へのインストール</h2><p>Rancher Desktop を Linux ディストリビューションの1つである <a href=https://mxlinux.org/ target=_blank rel="noopener noreffer">MXLinux</a> にインストールしてみます.</p>
<p>インストール方法は<a href=https://docs.rancherdesktop.io/installation#linux target=_blank rel="noopener noreffer">公式ドキュメント</a>に従って、Rancher Desktopのリポジトリを追加し、Rancher Desktopをインストールします.</p>
<p>Linux へのインストールはいくつかのパッケージがありますが、MXLinux は Debian(stable) ベースのため、<code>.deb</code>パッケージを使用します.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># リポジトリを取得し、登録
$ curl https://download.opensuse.org/repositories/isv:/Rancher:/stable/deb/Release.key | sudo apt-key add -
$ sudo add-apt-repository &#39;deb https://download.opensuse.org/repositories/isv:/Rancher:/stable/deb/ ./&#39;
# パッケージ一覧を更新
$ sudo apt update
# Rancher Desktop をインストール
$ sudo apt install rancher-desktop
</code></pre></td></tr></table>
</div>
</div><p>以上で、Rancher Desktop のインストールは完了です. 非常に簡単ですね.</p>
<div class="details admonition note">
<div class="details-summary admonition-title"><i class="icon admonition-icon icon-note"></i>MXLinux について<i class="details-icon admonition-icon admonition-icon-arrow-right"></i></div>
<div class=details-content>
<div class=admonition-content>MXLinux は DistroWatch.com でも 注目度の高い Linux ディストリビューションです.
antiX と旧 MEPIS Linux コミュニティ間の共同事業として構築されたプロジェクトでギリシャおよびアメリカにて開発されています.</div>
</div>
</div>
<h2 id=rancher-desktop-の起動 class=headerLink><a href=#rancher-desktop-%e3%81%ae%e8%b5%b7%e5%8b%95 class=header-mark></a>Rancher Desktop の起動</h2><p>インストールした Rancher Desktop を起動してみます. アプリケーション自体は非常にシンプルでした.</p>
<h3 id=general class=headerLink><a href=#general class=header-mark></a>General</h3><p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/rancher-desktop-general.webp alt=rancher-desktop-general title=rancher-desktop-general.webp></p>
<h3 id=kubernetes-setting class=headerLink><a href=#kubernetes-setting class=header-mark></a>Kubernetes Setting</h3><p>次に、Kubernetes の設定を見てみます.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/rancher-desktop-k8s-setting.webp alt=rancher-desktop-k8s-setting title=rancher-desktop-k8s-setting.webp></p>
<p><code>Kubernetes version</code>では、Kubernetes のバージョンを指定できます. 執筆時点での最新バージョンである v1.23.3 から、最も古いバージョンで v1.16.7 まで選択が可能です.</p>
<p><code>Port</code>はデフォルトでは、<code>6443</code>が設定されています.</p>
<p><code>Container runtime</code>では、<code>containerd</code>または<code>dockerd (moby)</code>のどちらかを選択可能です.</p>
<p><code>Memory (GB)</code>, <code>CPUs</code>は、メモリー、CPUのコア数を指定できます. 赤いラインまで数値を上げると、下図のように警告文が表示されます.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/rancher-desktop-k8s-setting-danger.webp alt=rancher-desktop-k8s-setting-danger title=rancher-desktop-k8s-setting-danger.webp></p>
<p>一度、環境をクリーンアップしたい場合は、<code>Reset Kubernetes</code>を押すことで簡単にリセットすることができます.</p>
<h3 id=supporting-utilities class=headerLink><a href=#supporting-utilities class=header-mark></a>Supporting Utilities</h3><p><code>Supporting Utilities</code>では、インストールされたツール郡が表示されています. 既にインストールされていた Docker などに対しては、丁寧に注意喚起が書かれていました.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/rancher-desktop-supporting-utilities.webp alt=rancher-desktop-supporting-utilities title=rancher-desktop-supporting-utilities.webp></p>
<h3 id=images class=headerLink><a href=#images class=header-mark></a>Images</h3><p><code>Images</code> では、Rancher Desktop で使用しているイメージが表示されています. イメージ一覧の<code>⋮</code>から<code>Scan</code>を選択すると、イメージの脆弱性を <a href=https://github.com/aquasecurity/trivy target=_blank rel="noopener noreffer">Trivy</a> を使用してスキャンしてくれる.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/rancher-desktop-images.webp alt=rancher-desktop-images title=rancher-desktop-images.webp></p>
<p>ここで、<code>Image Namespace</code>に注目してください. <code>containerd</code>では、Kubernetes と同様に<code>namespace</code>という概念が存在しています.
そのため、Kubenetes が <code>namespace</code>を持つことができるように、<code>containerd</code>も同じように<code>namespace</code>を持つことができます.
上図では、<code>namespace:k8s.io</code>にイメージが存在しているということになります.</p>
<p>実際に<code>nerdctl</code>コマンドを使用して、<code>namespace</code>を確認してみます. <code>nerdctl namespace list</code>で<code>namespace</code>の一覧を表示します.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ ./.local/bin/nerdctl namespace list
NAME        CONTAINERS    IMAGES    VOLUMES
buildkit    0             0         0
k8s.io      22            16        0
</code></pre></td></tr></table>
</div>
</div><p>実行してみると、<code>k8s.io</code>にイメージが存在していることが確認できました.</p>
<p>また、<code>nerdctl --namespace k8s.io ps</code>で<code>namespace:k8s.io</code>で、Rancher Desktop で作成した Kubernetes のコンテナ群が確認できます.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ ./.local/bin/nerdctl --namespace k8s.io ps
CONTAINER ID    IMAGE                                               COMMAND                   CREATED           STATUS    PORTS    NAMES
1f642d94e7d5    docker.io/rancher/klipper-lb:v0.3.4                 &#34;entry&#34;                   50 minutes ago    Up                 k8s://kube-system/svclb-traefik-svnfr/lb-port-443                                   
2ca56d5f0874    docker.io/rancher/mirrored-library-traefik:2.5.6    &#34;/entrypoint.sh --gl…&#34;    49 minutes ago    Up                 k8s://kube-system/traefik-6bb96f9bd8-cflf4/traefik                                  
2f1c800451cf    docker.io/rancher/mirrored-coredns-coredns:1.8.6    &#34;/coredns -conf /etc…&#34;    49 minutes ago    Up                 k8s://kube-system/coredns-5789895cd-wgxlq/coredns                                   
56bd8fba2fda    docker.io/rancher/klipper-lb:v0.3.4                 &#34;entry&#34;                   50 minutes ago    Up                 k8s://kube-system/svclb-traefik-svnfr/lb-port-80                                    
5908afd18045    docker.io/rancher/mirrored-pause:3.6                &#34;/pause&#34;                  49 minutes ago    Up                 k8s://kube-system/coredns-5789895cd-wgxlq                                           
8c16131e6d1b    docker.io/rancher/mirrored-pause:3.6                &#34;/pause&#34;                  50 minutes ago    Up                 k8s://kube-system/svclb-traefik-svnfr                                               
95b859fec9ed    docker.io/rancher/mirrored-pause:3.6                &#34;/pause&#34;                  49 minutes ago    Up                 k8s://kube-system/local-path-provisioner-6c79684f77-plbxh                           
a0656b86ab35    docker.io/rancher/local-path-provisioner:v0.0.21    &#34;local-path-provisio…&#34;    49 minutes ago    Up                 k8s://kube-system/local-path-provisioner-6c79684f77-plbxh/local-path-provisioner    
a5c31106d6d7    docker.io/rancher/mirrored-pause:3.6                &#34;/pause&#34;                  49 minutes ago    Up                 k8s://kube-system/traefik-6bb96f9bd8-cflf4                                          
c9417746b27d    docker.io/rancher/mirrored-pause:3.6                &#34;/pause&#34;                  49 minutes ago    Up                 k8s://kube-system/metrics-server-7cd5fcb6b7-4cbkd                                   
ce64e7b0a242    docker.io/rancher/mirrored-metrics-server:v0.5.2    &#34;/metrics-server --c…&#34;    49 minutes ago    Up                 k8s://kube-system/metrics-server-7cd5fcb6b7-4cbkd/metrics-server  
</code></pre></td></tr></table>
</div>
</div><h3 id=troubleshooting class=headerLink><a href=#troubleshooting class=header-mark></a>Troubleshooting</h3><p><code>Troubleshooting</code>では、ログの有効化、また Rancher Desktop 自体の初期化ができます.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/rancher-desktop-troubleshooting.webp alt=rancher-desktop-troubleshooting title=rancher-desktop-troubleshooting.webp></p>
<h2 id=検証 class=headerLink><a href=#%e6%a4%9c%e8%a8%bc class=header-mark></a>検証</h2><p>Rancher Desktop 上で、実際にコンテナなどを動かして見ます.</p>
<h3 id=nerdctl-の使用 class=headerLink><a href=#nerdctl-%e3%81%ae%e4%bd%bf%e7%94%a8 class=header-mark></a>nerdctl の使用</h3><p><code>nerdctl</code>コマンドを使用して、nginx を起動してみます. <code>namespace</code> は未指定の場合、デフォルトで<code>default</code>に配置されます.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback># nginx を起動
$ ./.local/bin/nerdctl run -d -p 9999:80 nginx
docker.io/library/nginx:latest:                                                   resolved       |++++++++++++++++++++++++++++++++++++++| 
index-sha256:2834dc507516af02784808c5f48b7cbe38b8ed5d0f4837f16e78d00deb7e7767:    done           |++++++++++++++++++++++++++++++++++++++| 
...
elapsed: 7.2 s                                                                    total:  54.1 M (7.5 MiB/s)                                       
484e86556e00843200c97b5aa779ba81a9016796e23964e5a0cac27159de444e

# コンテナの状態を確認
$ ./.local/bin/nerdctl ps
CONTAINER ID    IMAGE                             COMMAND                   CREATED          STATUS    PORTS                   NAMES
484e86556e00    docker.io/library/nginx:latest    &#34;/docker-entrypoint.…&#34;    6 minutes ago    Up        0.0.0.0:9999-&gt;80/tcp    nginx-484e8

# namespace を確認
$ ./.local/bin/nerdctl namespace list
NAME        CONTAINERS    IMAGES    VOLUMES
buildkit    0             0         0
default     1             1         0
k8s.io      22            16        0

# namespace default のプロセスを確認
$ ./.local/bin/nerdctl --namespace default ps
CONTAINER ID    IMAGE                             COMMAND                   CREATED           STATUS    PORTS                   NAMES
484e86556e00    docker.io/library/nginx:latest    &#34;/docker-entrypoint.…&#34;    11 minutes ago    Up        0.0.0.0:9999-&gt;80/tcp    nginx-484e8
</code></pre></td></tr></table>
</div>
</div><p>また、Rancher Desktop からも、<code>namespace:default</code>に nginx イメージを確認することができます.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/rancher-desktop-run-nginx.webp alt=rancher-desktop-run-nginx title=rancher-desktop-run-nginx.webp></p>
<p>最後に、<code>localhost:9999</code>にアクセスして、nginx の起動を確認してみます.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/run-nginx.webp alt=run-nginx title=run-nginx.webp></p>
<h3 id=helm-の使用 class=headerLink><a href=#helm-%e3%81%ae%e4%bd%bf%e7%94%a8 class=header-mark></a>Helm の使用</h3><p>Rancher Desktop では、起動時に Helm もインストールされるので、Helm を使って Kubernetes に Grafana をデプロイしてみます.</p>
<h4 id=helm-に-grafana-のリポジトリを追加 class=headerLink><a href=#helm-%e3%81%ab-grafana-%e3%81%ae%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa%e3%82%92%e8%bf%bd%e5%8a%a0 class=header-mark></a>Helm に Grafana のリポジトリを追加</h4><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ ./.local/bin/helm repo add grafana https://grafana.github.io/helm-charts
</code></pre></td></tr></table>
</div>
</div><h4 id=helm-にリポジトリが追加されていることを確認 class=headerLink><a href=#helm-%e3%81%ab%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa%e3%81%8c%e8%bf%bd%e5%8a%a0%e3%81%95%e3%82%8c%e3%81%a6%e3%81%84%e3%82%8b%e3%81%93%e3%81%a8%e3%82%92%e7%a2%ba%e8%aa%8d class=header-mark></a>Helm にリポジトリが追加されていることを確認</h4><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ ./.local/bin/helm repo list
NAME    URL                                  
grafana https://grafana.github.io/helm-charts
</code></pre></td></tr></table>
</div>
</div><h4 id=追加した-grafana-リポジトリからチャートを確認 class=headerLink><a href=#%e8%bf%bd%e5%8a%a0%e3%81%97%e3%81%9f-grafana-%e3%83%aa%e3%83%9d%e3%82%b8%e3%83%88%e3%83%aa%e3%81%8b%e3%82%89%e3%83%81%e3%83%a3%e3%83%bc%e3%83%88%e3%82%92%e7%a2%ba%e8%aa%8d class=header-mark></a>追加した Grafana リポジトリからチャートを確認</h4><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ ./.local/bin/helm search repo grafana
NAME                            CHART VERSION   APP VERSION DESCRIPTION                                       
grafana/grafana                 6.21.1          8.3.4       The leading tool for querying and visualizing t...
grafana/grafana-agent-operator  0.1.5           0.22.0      A Helm chart for Grafana Agent Operator           
grafana/enterprise-logs         2.0.0           v1.3.0      Grafana Enterprise Logs                           
grafana/enterprise-metrics      1.7.3           v1.6.1      Grafana Enterprise Metrics                        
grafana/fluent-bit              2.3.0           v2.1.0      Uses fluent-bit Loki go plugin for gathering lo...
grafana/loki                    2.9.1           v2.4.2      Loki: like Prometheus, but for logs.              
grafana/loki-canary             0.5.1           2.4.1       Helm chart for Grafana Loki Canary                
grafana/loki-distributed        0.42.0          2.4.2       Helm chart for Grafana Loki in microservices mode 
grafana/loki-simple-scalable    0.2.0           2.4.2       Helm chart for Grafana Loki in simple, scalable...
grafana/loki-stack              2.5.1           v2.1.0      Loki: like Prometheus, but for logs.              
grafana/promtail                3.10.0          2.4.2       Promtail is an agent which ships the contents o...
grafana/tempo                   0.13.0          1.3.0       Grafana Tempo Single Binary Mode                  
grafana/tempo-distributed       0.15.0          1.3.0       Grafana Tempo in MicroService mode                
grafana/tempo-vulture           0.2.0           1.3.0       Grafana Tempo Vulture - A tool to monitor Tempo...

</code></pre></td></tr></table>
</div>
</div><h4 id=helm-チャートをリリース class=headerLink><a href=#helm-%e3%83%81%e3%83%a3%e3%83%bc%e3%83%88%e3%82%92%e3%83%aa%e3%83%aa%e3%83%bc%e3%82%b9 class=header-mark></a>Helm チャートをリリース</h4><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ ./.local/bin/kubectl create namespace monitoring
$ ./.local/bin/helm install grafana --namespace monitoring grafana/grafana
W0128 03:37:33.477723  218028 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
W0128 03:37:33.480386  218028 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
W0128 03:37:33.538004  218028 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
W0128 03:37:33.538201  218028 warnings.go:70] policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+
NAME: grafana
LAST DEPLOYED: Fri Jan 28 03:37:32 2022
NAMESPACE: monitoring
STATUS: deployed
REVISION: 1
NOTES:
1. Get your &#39;admin&#39; user password by running:

   kubectl get secret --namespace monitoring grafana -o jsonpath=&#34;{.data.admin-password}&#34; | base64 --decode ; echo

2. The Grafana server can be accessed via port 80 on the following DNS name from within your cluster:

   grafana.monitoring.svc.cluster.local

   Get the Grafana URL to visit by running these commands in the same shell:

     export POD_NAME=$(kubectl get pods --namespace monitoring -l &#34;app.kubernetes.io/name=grafana,app.kubernetes.io/instance=grafana&#34; -o jsonpath=&#34;{.items[0].metadata.name}&#34;)
     kubectl --namespace monitoring port-forward $POD_NAME 3000

3. Login with the password from step 1 and the username: admin
#################################################################################
######   WARNING: Persistence is disabled!!! You will lose your data when   #####
######            the Grafana pod is terminated.                            #####
#################################################################################
</code></pre></td></tr></table>
</div>
</div><p>上記の手順に従って、正常に Grafana にログインすることができました.</p>
<p>
<img loading=lazy decoding=async class=render-image src=/2022/01/setup-rancher-desktop-on-mxlinux/grafana-dashboard.webp alt=grafana-dashboard title=grafana-dashboard.webp></p>
<p>最後に、<code>kubectl</code>コマンドを使って Grafana が立ち上がっていることを確認します.</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback>$ ./.local/bin/kubectl get all --namespace monitoring
NAME                           READY   STATUS    RESTARTS   AGE
pod/grafana-6b9d4f7f86-mwb4q   1/1     Running   0          15m

NAME              TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
service/grafana   ClusterIP   10.43.218.65   &lt;none&gt;        80/TCP    15m

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/grafana   1/1     1            1           15m

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/grafana-6b9d4f7f86   1         1         1       15m
</code></pre></td></tr></table>
</div>
</div><p>以上のように、Rancher Desktop を起動するだけでアプリケーションの開発やデプロイが簡単に行うことができました.</p>
<h2 id=所感 class=headerLink><a href=#%e6%89%80%e6%84%9f class=header-mark></a>所感</h2><p>今回は、v1.0.0 がリリースされた Rancher Desktop を触ってみましたが、非常に完成度の高いツールでした. <code>containerd</code>、<code>nerdctl</code>を初めて触る方も Rancher Desktop は良い機会だと思います.</p>
<p>昨年、<a href=https://www.docker.com/blog/updating-product-subscriptions/ target=_blank rel="noopener noreffer">Docker Desktopが有料化</a>が大きなニュースとなり、それに伴い、密かに代替案として注目されていた Rancher Desktop ですが、
Docker Desktop から乗り換えたとしても遜色なく利用できるかと思います. 万が一、Docker のランタイムを使用したいと思えば、Rancher Desktop 上から切り替えれば良いので、大して手間は掛かりません.</p>
<p>また、Kubernetes のバージョンをスムーズに切り替えられるのも個人的には大きなメリットなのかなと思います.</p>
<p>これから、コンテナを利用する手段の1つとして、広く普及していく可能性は大いにあり得るので、今後の動向に注目していきたいと思います.</p></div><footer>
<div class=post>
<div class=post-share><div class=share-link>
<a class="share-icon share-twitter" href=javascript:void(0); title="共有する Twitter" data-sharer=twitter data-url=https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/ data-title="MXLinux で Rancher Desktop を動かす" data-via=m0rer0 data-hashtags=kubernetes,k3s,rancher,helm,containerd,moby,linux,mxlinux><span class="svg-social-icon icon-twitter"></span></a>
</div><div class=share-link>
<a class="share-icon share-facebook" href=javascript:void(0); title="共有する Facebook" data-sharer=facebook data-url=https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/ data-hashtag=kubernetes><span class="svg-social-icon icon-facebook"></span></a>
</div><div class=share-link>
<a class="share-icon share-line" href=javascript:void(0); title="共有する Line" data-sharer=line data-url=https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/ data-title="MXLinux で Rancher Desktop を動かす"><span class="svg-social-icon icon-line"></span></a>
</div><div class=share-link>
<a class="share-icon share-hackernews" href=javascript:void(0); title="共有する Hacker News" data-sharer=hackernews data-url=https://t4i5uKE.github.io/2022/01/setup-rancher-desktop-on-mxlinux/ data-title="MXLinux で Rancher Desktop を動かす"><span class="svg-social-icon icon-hacker-news"></span></a>
</div></div>
<div class=post-tags><a href=/tags/kubernetes/ class=tag>kubernetes</a><a href=/tags/k3s/ class=tag>k3s</a><a href=/tags/rancher/ class=tag>rancher</a><a href=/tags/helm/ class=tag>helm</a><a href=/tags/containerd/ class=tag>containerd</a><a href=/tags/moby/ class=tag>moby</a><a href=/tags/linux/ class=tag>linux</a><a href=/tags/mxlinux/ class=tag>mxlinux</a></div></div>
</footer></div>
<div id=toc-final></div>
</div>
</article>
<section class="page single comments content-block-position">
<h1 class=display-hidden>Комментарии</h1><div id=comments></div></section></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line><i class="svg-icon icon-copyright"></i><span>2021 - 2022</span><span class=author>&nbsp;<a href=/ target=_blank></a></span>&nbsp;|&nbsp;<span class=license>t4i5uKE (morero)</span></div>
</div>
</footer></div>
<aside id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=トップページへ戻る>
<i class="svg-icon icon-arrow-up"></i>
</a><a href=# id=view-comments class=fixed-button title=コメントを見る>
<i class="svg-icon icon-comments-fixed"></i>
</a>
</aside><script src=https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.37.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/algoliasearch@4.2.0/dist/algoliasearch-lite.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js></script><script src=/lib/prismjs/prism.js></script><script>window.config={code:{copyTitle:"クリップボードにコピー",maxShownLines:10},comment:{},search:{algoliaAppID:"PASDMWALPK",algoliaIndex:"index.ja",algoliaSearchKey:"b42948e51daaa93df92381c8e2ac0f93",highlightTag:"em",maxResultLength:10,noResultsFound:"該当する結果はありません",snippetLength:30,type:"algolia"}}</script><script src=/js/theme.min.js></script></body>
</html>